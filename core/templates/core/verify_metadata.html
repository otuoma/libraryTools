{% extends 'base.html' %}
{% load form_extras %}
{% block content %}
  <h2 class="mb-4">Verify and Edit Metadata</h2>
  {% if program %}
    <div class="alert alert-info mb-3">
      <strong>Program:</strong> {{ program }}
    </div>
  {% endif %}

  <form method="post" enctype="multipart/form-data" action="{% url 'verify_metadata' %}" class="card p-4 shadow-sm mb-4">
    {% csrf_token %}
    <div class="row g-3">
      {{ form.pdf_path }}
      <div class="col-md-4">{{ form.academic_year.label_tag }}{{ form.academic_year|add_class:'form-control' }}</div>
      <div class="col-md-4">{{ form.year_of_study.label_tag }}{{ form.year_of_study|add_class:'form-control' }}</div>
      <div class="col-md-4">{{ form.course_title.label_tag }}{{ form.course_title|add_class:'form-control' }}</div>
      <div class="col-md-4">{{ form.semester.label_tag }}{{ form.semester|add_class:'form-control' }}</div>
      <div class="col-md-4">{{ form.level_of_study.label_tag }}{{ form.level_of_study|add_class:'form-select' }}</div>
      <div class="col-md-4">{{ form.course_code.label_tag }}{{ form.course_code|add_class:'form-control' }}</div>
      <div class="col-md-4">{{ form.exam_type.label_tag }}{{ form.exam_type|add_class:'form-select' }}</div>
      <div class="col-md-4">
        
        {% if collections and collections|length > 0 %}
          {{ form.collection.label_tag }}
          <select name="program" class="form-select">
            <option value="">Select a collection</option>
            {% for collection in collections %}
              <option value="{{ collection.collection_uuid }}">{{ collection.collection_name }}</option>
            {% endfor %}
          </select>
        {% else %}
          {{ form.collection.label_tag }}
          <input type="text" name="program" class="form-control" placeholder="Manually enter collection UUID" />
        {% endif %}
      </div>
      
    <div class="row mt-3">
      <div class="col-md-6">
        <button type="submit" class="btn btn-primary">Save Metadata</button>
      </div>
        <div class="col-md-6 text-end">
            <a href="{% url 'upload_exam_paper' %}" class="btn btn-secondary">Upload Another Paper</a>
        </div>
    </div>
    {% if form.errors %}
      <div class="alert alert-danger mt-3">
        <strong>Please correct the errors below:</strong>
        <ul class="mb-0">
          {% for field in form %}
            {% for error in field.errors %}
              <li>{{ field.label }}: {{ error }}</li>
            {% endfor %}
          {% endfor %}
          {% for error in form.non_field_errors %}
            <li>{{ error }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}
  </form>
  {% if extracted_text %}
    <div class="card mt-3">
      <div class="card-header bg-light"><strong>Extracted Text from First Page</strong></div>
      <div class="card-body">
        <pre class="mb-0">{{ extracted_text }}</pre>
      </div>
    </div>
  {% endif %}
{% endblock %}
